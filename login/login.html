<!--<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <script>window.$ = window.jQuery = require('jquery');</script>
    <link rel="stylesheet" href="../assets/css/login.css" id="stylesheetLight">
    <link rel="stylesheet" href="../assets/css/login.css" id="stylesheetDark">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">

    <style>
      body {
        display: none;
      }
    </style>
    <title>Login</title>
  </head>
  <body class="d-flex align-items-center bg-auth border-top border-top-2" style=" -webkit-user-select: none; -webkit-app-region: drag;">
    <div class="container" style="-webkit-app-region: no-drag;">
      <div class="row justify-content-center">
        <div class="col-12 col-md-5 col-xl-4 my-5">
          <h1 class="display-4 text-center mb-3">
            Sign in
          </h1>
          <p class="text-muted text-center mb-5">
            Automating Boring Stuff
          </p>
          <div>
            <div class="form-group">
              <label>Username</label>
              <input type="text" class="form-control" placeholder="Enter your username" id="username">

            </div>
            <div class="form-group">

              <div class="row">
                <div class="col">
                      
                  <label>Password</label>

                </div>
                <div class="col-auto">
                  
                  <a onclick='CreateWindow("https://www.boringio.com/changePass/")' style="cursor: pointer;" target="_blank" class="form-text small text-muted">
                    Forgot password?
                  </a>

                </div>
              </div>

              <input type="password" id="password" class="form-control" placeholder="Enter your password">

            </div>

            <button class="btn btn-lg btn-block btn-primary mb-3" id = "loginBtn" onclick="Login()">
              Sign in
            </button>

            <div class="text-center">
              <small class="text-muted text-center">
                Don't have an account yet? <a onclick="CreateWindow('https://www.boringio.com/signup/')" target="blank" style="color: #f1743b; cursor: pointer;">Sign up</a>.
              </small>
            </div>
            <div class="text-center" id="ErrorLabel" style="color: rgb(185, 40, 40); font-size: 20px;">      
            </div>
          </div>

        </div>
      </div>
    </div>
    <script>
      const fs = require('fs')
      const ipc = require('electron').ipcRenderer
      const app = require("electron").remote.app
      var mysql = require('mysql')
      const path = require("path")
      const bcrypt = require('bcrypt')
      let $ = require('jquery')
      var AccountSavedDirectory = path.join(app.getPath("userData"),"/AccountSaved.txt")
      var UsernameSaved
      var PasswordSaved
      var BETA_MODE = true
      var pool = require("electron").remote.getGlobal('pool')
  
      function Minimize(){
          ipc.send("Minimize","login")
      }
  
      function Maximize(){
          ipc.send("Maximize","login")
      }
  
      function Close(){
          ipc.send("Close","login")
      }
  
      function CreateWindow(Type){
        console.log(Type)
        ipc.send("CreateWindow",Type)
      }
  
      async function Login(){
        var Username = document.getElementById('username').value
        var Password = document.getElementById('password').value
        var Data = {
          Username: Username,
          Password: Password,
          CryptedPass:false
        }
        fetch('https://www.boringio.com:5035/DesktopAppAuth',{
          method: 'POST',
          body: JSON.stringify(Data),
          headers: {
            'Content-Type': 'application/json'
          },
          referrer: 'no-referrer'
        }).then(function (response) {
          if (response.ok) {
            return response.json();
          } else {
            return Promise.reject(response);
          }
        }).then(async function (data) {
          if(data.Code == 1){
            ipc.invoke('setUserId', data.Profile.UserId)
            ipc.invoke('setAttachedInventory',data.Profile.AccountAttached)
            ipc.invoke('setUsername', data.Profile.Username)
            ipc.invoke('setEmail', data.Profile.Email)
            ipc.invoke('setRenew', data.Profile.TypeSubscription)
            ipc.invoke('setRenewDays', data.Profile.NextDate)
            ipc.invoke('setImg', data.Profile.Immagine)
            ipc.invoke('setValuta', data.Profile.Valuta)
            fs.writeFile(AccountSavedDirectory, Username+":"+data.Profile.Password, function (err) {
            if (err) throw err;
                console.log('Saved!');
            });
            ipc.send('entry-accepted', 'start')
          }else if(data.Code == 2){
            document.getElementById('ErrorLabel').innerText = "       This user is Not active or Expired"
          }else if(data.Code == 3){
            document.getElementById('ErrorLabel').innerText = "       Wrong username or password"
          }
        }).catch(function (err){
          console.log(err)
        })
      }
      </script>
    <script>if (typeof module === 'object') 
      {window.module = module; 
      module = undefined;}</script>
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    <script>if(window.module){module = window.module;}</script>
  </body>
</html>-->
<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title></title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link rel="shortcut icon" href="../Dashboard/img/logo.ico"/>
    <link href="../assets/css/styleLogin.css" rel="stylesheet" type="text/css" media="all" />
  </head>
  <body style="-webkit-app-region: drag;overflow: hidden;">
    <div class="loader">
      <div class="loading-animation"></div>
    </div>
    <section class="min-vh-100 py-5">
      <div class="container">
        <div class="row justify-content-center mb-md-6">
          <div class="col-auto">
            <a>
              <span style="color: #fff;font-size: 20px;">Boring</span>
            </a>
          </div>
        </div>
        <div class="row justify-content-center pt-6"  style="-webkit-app-region: no-drag">
          <div class="col-xl-4 col-lg-5 col-md-6">
            <div class="text-center mb-4">
              <h1 class="mb-1">Welcome back</h1>
              <span>Enter your account details below</span>
            </div>
            <div>
              <div class="form-group">
                <input type="text" name="login-email" placeholder="Username" id="username" class="form-control">
              </div>
              <div class="form-group">
                <input type="password" name="login-password" placeholder="Password" id="password" class="form-control">
                <small><a onclick = "CreateWindow('https://www.boringio.com/changePass/')" style="cursor: pointer;">Forgot your password?</a>
                </small>
              </div>
              <div class="form-group">
                <button class="btn-block btn btn-primary" onclick="Login()">Sign in</button>
              </div>
              <div id="ErrorLabel">

              </div>
              <hr>
              <div class="text-center text-small text-muted">
                <span>Don't have an account yet? <a onclick="CreateWindow('https://www.boringio.com/signup/')" style="cursor: pointer;">Create one</a>
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <script>if (typeof module === 'object') 
      {window.module = module; 
      module = undefined;}</script>
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    <script>
      const fs = require('fs')
      const ipc = require('electron').ipcRenderer
      const app = require("electron").remote.app
      var mysql = require('mysql')
      const path = require("path")
      const bcrypt = require('bcrypt')
      let $ = require('jquery')
      var AccountSavedDirectory = path.join(app.getPath("userData"),"/AccountSaved.txt")
      var UsernameSaved
      var PasswordSaved
      var BETA_MODE = true
      var pool = require("electron").remote.getGlobal('pool')
  
      function Minimize(){
          ipc.send("Minimize","login")
      }
  
      function Maximize(){
          ipc.send("Maximize","login")
      }
  
      function Close(){
          ipc.send("Close","login")
      }
  
      function CreateWindow(Type){
        console.log(Type)
        ipc.send("CreateWindow",Type)
      }
  
      async function Login(){
        var Username = document.getElementById('username').value
        var Password = document.getElementById('password').value
        var Data = {
          Username: Username,
          Password: Password,
          CryptedPass:false
        }
        fetch('https://www.boringio.com:5035/DesktopAppAuth',{
          method: 'POST',
          body: JSON.stringify(Data),
          headers: {
            'Content-Type': 'application/json'
          },
          referrer: 'no-referrer'
        }).then(function (response) {
          if (response.ok) {
            return response.json();
          } else {
            return Promise.reject(response);
          }
        }).then(async function (data) {
          if(data.Code == 1){
            ipc.invoke('setUserId', data.Profile.UserId)
            ipc.invoke('setAttachedInventory',data.Profile.AccountAttached)
            ipc.invoke('setUsername', data.Profile.Username)
            ipc.invoke('setEmail', data.Profile.Email)
            ipc.invoke('setRenew', data.Profile.TypeSubscription)
            ipc.invoke('setRenewDays', data.Profile.NextDate)
            ipc.invoke('setImg', data.Profile.Immagine)
            ipc.invoke('setValuta', data.Profile.Valuta)
            fs.writeFile(AccountSavedDirectory, Username+":"+data.Profile.Password, function (err) {
            if (err) throw err;
                console.log('Saved!');
            });
            ipc.send('entry-accepted', 'start')
          }else if(data.Code == 2){
            document.getElementById('ErrorLabel').innerHTML =  '<div class="alert alert-primary" role="alert" style="text-align: center;width: 100%;font-size: 15px;font-weight: 500;border-radius: 100px;">Wrong username or password</div>'
          }else if(data.Code == 3){
            document.getElementById('ErrorLabel').innerHTML =  '<div class="alert alert-primary" role="alert" style="text-align: center;width: 100%;font-size: 15px;font-weight: 500;border-radius: 100px;">Wrong username or password</div>'
          }
        }).catch(function (err){
          console.log(err)
        })
      }
      </script>
  </body>
</html>